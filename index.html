<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Clicker</title>
<style>
body {
    margin: 0;
    background:#222;
    font-family: Arial;
    color:white;
    text-align:center;
}
#container {
    max-width: 500px;
    margin:40px auto;
}
input, button {
    padding:10px;
    font-size:18px;
    width:90%;
    margin-bottom:10px;
    border:none;
    border-radius:6px;
}
button { cursor:pointer; }
#game { display:none; }

#leaderboard, #onlinePlayers {
    margin-top:25px;
    background:#333;
    padding:10px;
    border-radius:8px;
}
.item {
    padding:5px;
    border-bottom:1px solid #555;
    text-align:left;
}
</style>
</head>
<body>

<div id="container">

    <div id="login">
        <h2>Регистрация</h2>
        <input id="username" placeholder="Имя">
        <input id="password" placeholder="Пароль" type="password">
        <button onclick="register()">Войти</button>
    </div>

    <div id="game">
        <h2 id="welcome"></h2>
        <h1 id="score">0</h1>
        <button onclick="clickBtn()">Клик!</button>

        <div id="leaderboard">
            <h3>Таблица лидеров</h3>
            <div id="list"></div>
        </div>

        <div id="onlinePlayers">
            <h3>Игроки онлайн</h3>
            <div id="onlineList"></div>
        </div>
    </div>

</div>

<script>
let user = null;
let score = 0;
let updateTimer;

// ========== Leaderboard ==========
function saveLeaderboard() {
    let lb = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    let exist = lb.find(x => x.name === user);
    if (exist) exist.score = score;
    else lb.push({ name: user, score: score });
    lb.sort((a,b)=>b.score-a.score);
    localStorage.setItem("leaderboard", JSON.stringify(lb));
    renderLeaderboard();
}

function renderLeaderboard() {
    let lb = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    let html = "";
    lb.forEach((p,i)=>{
        html += `<div class="item">${i+1}. ${p.name} — ${p.score}</div>`;
    });
    document.getElementById("list").innerHTML = html;
}

// ========== ONLINE PLAYERS ==========
function updateOnline() {
    let now = Date.now();
    let online = JSON.parse(localStorage.getItem("onlinePlayers") || "{}");

    online[user] = now;
    localStorage.setItem("onlinePlayers", JSON.stringify(online));

    let html = "";
    for (let name in online) {
        if (now - online[name] < 3000) {
            html += `<div class="item">${name}</div>`;
        }
    }
    document.getElementById("onlineList").innerHTML = html;
}

// ========== LOGIN ==========
function register() {
    let name = document.getElementById("username").value.trim();
    let pass = document.getElementById("password").value.trim();
    if (!name || !pass) return;

    let accs = JSON.parse(localStorage.getItem("accounts") || "{}");

    if (!accs[name]) {
        accs[name] = pass;
    } else {
        if (accs[name] !== pass) {
            alert("Неверный пароль");
            return;
        }
    }

    localStorage.setItem("accounts", JSON.stringify(accs));

    user = name;

    let lb = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    let exist = lb.find(x => x.name === user);
    score = exist ? exist.score : 0;

    document.getElementById("welcome").innerText = "Игрок: " + user;
    document.getElementById("score").innerText = score;

    document.getElementById("login").style.display = "none";
    document.getElementById("game").style.display = "block";

    renderLeaderboard();

    updateOnline();
    updateTimer = setInterval(updateOnline, 1000);
}

// ========== CLICK ==========
function clickBtn() {
    score++;
    document.getElementById("score").innerText = score;
    saveLeaderboard();
}
</script>

</body>
</html>
