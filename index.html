<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Y ‚Äî —Å–æ—Ü —Å–µ—Ç—å</title>
<style>
body {
    margin: 0;
    background: #111;
    color: white;
    font-family: Arial;
}
.center {
    display: flex; flex-direction: column;
    width: 300px; margin: 40px auto;
}
input {
    padding: 10px; margin: 5px 0;
    border: none; border-radius: 5px;
    width: 100%;
}
button {
    padding: 10px; border: none;
    width: 100%; border-radius: 5px;
    background: #1da1f2; color: white;
    font-size: 16px; cursor: pointer;
}
.hidden { display: none; }
#feed {
    max-width: 600px; margin: 20px auto;
}
.tweet {
    background: #222; padding: 15px;
    margin-bottom: 10px; border-radius: 10px;
}
.reacts span {
    margin-right: 10px; cursor: pointer;
}
.avatar {
    width: 60px; height: 60px; border-radius: 50%;
    object-fit: cover; margin-bottom: 10px;
}
</style>
</head>
<body>

<!-- ========== –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ========== -->
<div id="register" class="center">
    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input id="regNick" placeholder="–ù–∏–∫">
    <input id="regPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password">
    <input id="regPass2" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" type="password">
    <input id="regAvatar" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫—É">
    <button onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    <button onclick="showLogin()">–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
</div>

<!-- ========== –í–•–û–î ========== -->
<div id="login" class="center hidden">
    <h2>–í—Ö–æ–¥</h2>
    <input id="logNick" placeholder="–ù–∏–∫">
    <input id="logPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <button onclick="showRegister()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
</div>

<!-- ========== –ú–ï–ù–Æ / –¢–í–ò–¢–´ ========== -->
<div id="menu" class="hidden" style="padding:20px;">
    <h2>–õ–µ–Ω—Ç–∞</h2>

    <div>
        <textarea id="tweetText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?" style="width:100%; height:60px; border-radius:10px; padding:10px;"></textarea>
        <input id="tweetImg" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="width:100%; margin-top:5px;">
        <button onclick="sendTweet()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>

    <div id="feed"></div>
</div>

<script>
// ========== FIREBASE ==========
const dbUrl = "https://aitube-8e681-default-rtdb.firebaseio.com/";

async function fb(path, method="GET", data=null) {
    let url = dbUrl + path + ".json";
    return await fetch(url, {
        method,
        body: data ? JSON.stringify(data) : undefined
    }).then(r=>r.json());
}

// ========== UI ==========
function showLogin(){ registerDiv.classList.add("hidden"); loginDiv.classList.remove("hidden"); }
function showRegister(){ loginDiv.classList.add("hidden"); registerDiv.classList.remove("hidden"); }
function showMenu(){ registerDiv.classList.add("hidden"); loginDiv.classList.add("hidden"); menuDiv.classList.remove("hidden"); }

const registerDiv = document.getElementById("register");
const loginDiv = document.getElementById("login");
const menuDiv = document.getElementById("menu");

// ========== –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ==========
async function register(){
    let nick = regNick.value.trim();
    let pass = regPass.value;
    let pass2 = regPass2.value;
    let avatar = regAvatar.value.trim();

    if(!nick || !pass || pass !== pass2){ alert("–û—à–∏–±–∫–∞"); return; }

    let users = await fb("users");
    if(users && users[nick]){
        alert("–ù–∏–∫ –∑–∞–Ω—è—Ç");
        return;
    }

    await fb("users/"+nick, "PUT", {pass, avatar});
    alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω");
    showLogin();
}

// ========== –í–•–û–î ==========
async function login(){
    let nick = logNick.value.trim();
    let pass = logPass.value;

    let user = await fb("users/"+nick);
    if(!user || user.pass !== pass){
        alert("–ù–µ–≤–µ—Ä–Ω–æ");
        return;
    }

    localStorage.nick = nick;
    showMenu();
    loadFeed();
}

// ========== –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø –¢–í–ò–¢–ê ==========
async function sendTweet(){
    let text = tweetText.value.trim();
    let img = tweetImg.value.trim();
    let nick = localStorage.nick;

    if(!text && !img) return;

    await fb("tweets", "POST", {
        nick, text, img,
        time: Date.now(),
        reactions: {like:0, laugh:0, wow:0}
    });

    tweetText.value = "";
    tweetImg.value = "";
    loadFeed();
}

// ========== –†–ï–ê–ö–¶–ò–ò ==========
async function react(id, type){
    let tweet = await fb("tweets/"+id);
    if(!tweet) return;

    tweet.reactions[type]++;

    await fb("tweets/"+id, "PUT", tweet);
    loadFeed();
}

// ========== –õ–ï–ù–¢–ê ==========
async function loadFeed(){
    let feed = document.getElementById("feed");
    feed.innerHTML = "";

    let tweets = await fb("tweets");
    if(!tweets) return;

    let items = Object.entries(tweets).sort((a,b)=>b[1].time - a[1].time);

    for(let [id,t] of items){
        let html = `
        <div class="tweet">
            <b>${t.nick}</b><br>
            ${t.text? `<div>${t.text}</div>`:""}
            ${t.img? `<img src="${t.img}" style="width:100%;margin-top:10px;border-radius:10px;">`:""}
            <div class="reacts" style="margin-top:10px;">
                <span onclick="react('${id}','like')">‚ù§Ô∏è ${t.reactions.like}</span>
                <span onclick="react('${id}','laugh')">üòÇ ${t.reactions.laugh}</span>
                <span onclick="react('${id}','wow')">üòÆ ${t.reactions.wow}</span>
            </div>
        </div>
        `;
        feed.innerHTML += html;
    }
}
</script>

</body>
</html>
