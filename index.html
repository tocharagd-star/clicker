<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Online Clicker</title>
<style>
body { background:#222; color:white; font-family:Arial; text-align:center; margin:0; }
input, button { padding:10px; font-size:18px; width:90%; margin-bottom:10px; border:none; border-radius:6px; }
button { cursor:pointer; }
#game { display:none; }
.item { padding:5px; border-bottom:1px solid #555; text-align:left; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"></script>

</head>
<body>

<h1>ONLINE CLICKER</h1>

<div id="login">
    <input id="name" placeholder="Имя">
    <input id="pass" placeholder="Пароль" type="password">
    <button onclick="register()">Войти / Зарегистрироваться</button>
</div>

<div id="game">
    <h2 id="welcome"></h2>
    <h1 id="score">0</h1>
    <button onclick="clickBtn()">Клик!</button>
    <h3>Игроки онлайн</h3>
    <div id="online"></div>
    <h3>Лидерборд</h3>
    <div id="leaders"></div>
</div>

<script>
// -------------------- ВАШ CONFIG --------------------
const firebaseConfig = {
  apiKey: "AIzaSyB7d3kYeYEcTUy8tz-hKbYMw5f5zbRH6Ug",
  authDomain: "clicker-3044c.firebaseapp.com",
  databaseURL: "https://clicker-3044c-default-rtdb.firebaseio.com",
  projectId: "clicker-3044c",
  storageBucket: "clicker-3044c.firebasestorage.app",
  messagingSenderId: "143909161656",
  appId: "1:143909161656:web:368498af1ab183e56d024d",
  measurementId: "G-JWS932SQBG"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
// ----------------------------------------------------------

let user = "";
let score = 0;
let upgrades = { autoClick: 0, bonusClick: 0 };

// ----------- REGISTRATION / LOGIN --------------
function register() {
    let n = name.value.trim();
    let p = pass.value.trim();
    if (!n || !p) return;

    user = n;

    db.ref("users/" + n).once("value").then(snap => {
        let data = snap.val();

        if (!data) {
            // создаём нового игрока
            db.ref("users/" + n).set({ password: p, score: 0, upgrades: upgrades });
            score = 0;
        } else {
            if (data.password !== p) { alert("Неверный пароль"); return; }
            score = data.score || 0;
            upgrades = data.upgrades || { autoClick:0, bonusClick:0 };
        }

        login.style.display = "none";
        game.style.display = "block";
        welcome.innerText = "Игрок: " + user;
        document.getElementById("score").innerText = score;

        appearOnline();
        listenOnline();
        listenLeaderboard();
        startAutoClick();
    });
}

// ----------- CLICK --------------
function clickBtn() {
    let bonus = 1 + (upgrades.bonusClick || 0);
    score += bonus;
    document.getElementById("score").innerText = score;
    db.ref("users/" + user + "/score").set(score);
}

// ----------- AUTOCLICK --------------
function startAutoClick() {
    setInterval(()=>{
        if(upgrades.autoClick) {
            score += upgrades.autoClick;
            document.getElementById("score").innerText = score;
            db.ref("users/" + user + "/score").set(score);
        }
    },1000);
}

// ----------- ONLINE PLAYERS --------------
function appearOnline() {
    setInterval(() => {
        db.ref("online/" + user).set(Date.now());
    }, 1000);
}

function listenOnline() {
    db.ref("online").on("value", snap => {
        let data = snap.val() || {};
        let now = Date.now();
        let html = "";
        for (let u in data) {
            if (now - data[u] < 3000) {
                html += `<div class="item">${u}</div>`;
            }
        }
        online.innerHTML = html;
    });
}

// ----------- LEADERBOARD --------------
function listenLeaderboard() {
    db.ref("users").on("value", snap => {
        let data = snap.val() || {};
        let arr = [];
        for (let u in data) {
            arr.push({ name: u, score: data[u].score || 0 });
        }
        arr.sort((a,b)=>b.score-a.score);
        let html = "";
        arr.forEach((p,i)=>{
            html += `<div class="item">${i+1}. ${p.name} — ${p.score}</div>`;
        });
        leaders.innerHTML = html;
    });
}
</script>

</body>
</html>
