<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Online Clicker</title>
<style>
body { background:#1e1e2f; color:#fff; font-family:sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; }
.container { width:400px; background:#2a2a3f; padding:20px; border-radius:12px; }
button { width:100%; padding:10px; margin:10px 0; border:none; border-radius:6px; background:#4e4eff; color:#fff; font-size:16px; cursor:pointer; }
#score { font-size:32px; text-align:center; margin:10px 0; }
.list { max-height:150px; overflow-y:auto; border:1px solid #555; border-radius:6px; padding:5px; margin-bottom:10px; }
.item { padding:5px; border-bottom:1px solid #444; }
</style>

<!-- Firebase compat SDK для GitHub Pages -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

</head>
<body>
<div class="container">
<h1>Online Clicker</h1>
<h2 id="welcome"></h2>
<div id="score">0</div>
<button id="clickBtn">Клик!</button>

<h3>Игроки онлайн</h3>
<div class="list" id="online"></div>

<h3>Лидерборд</h3>
<div class="list" id="leaders"></div>
</div>

<script>
// -------------------- Firebase Config --------------------
const firebaseConfig = {
  apiKey: "AIzaSyB7d3kYeYEcTUy8tz-hKbYMw5f5zbRH6Ug",
  authDomain: "clicker-3044c.firebaseapp.com",
  databaseURL: "https://clicker-3044c-default-rtdb.firebaseio.com",
  projectId: "clicker-3044c",
  storageBucket: "clicker-3044c.firebasestorage.app",
  messagingSenderId: "143909161656",
  appId: "1:143909161656:web:368498af1ab183e56d024d",
  measurementId: "G-JWS932SQBG"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
// ----------------------------------------------------------

// Рандомный ник
function randomNick() {
    const adj = ["Синий","Быстрый","Весёлый","Смешной","Ловкий"];
    const noun = ["Кот","Пёс","Кролик","Тигр","Лис"];
    return adj[Math.floor(Math.random()*adj.length)] + noun[Math.floor(Math.random()*noun.length)] + Math.floor(Math.random()*1000);
}

let user = randomNick();
let score = 0;
document.getElementById("welcome").innerText = "Игрок: " + user;

// Тест соединения
db.ref("test").set({ok:true}).then(()=> console.log("Firebase работает")).catch(e=>console.error("Ошибка Firebase:", e));

// Клик
document.getElementById("clickBtn").addEventListener("click",()=>{
    score++;
    document.getElementById("score").innerText = score;
    db.ref("users/" + user + "/score").set(score);
});

// Онлайн
function appearOnline(){
    setInterval(()=> db.ref("online/"+user).set(Date.now()),1000);
}

// Онлайн лист
function listenOnline(){
    db.ref("online").on("value",snap=>{
        const data = snap.val()||{};
        const now = Date.now();
        let html="";
        for(let u in data) if(now-data[u]<3000) html+=`<div class="item">${u}</div>`;
        document.getElementById("online").innerHTML = html;
    });
}

// Лидерборд
function listenLeaderboard(){
    db.ref("users").on("value",snap=>{
        const data = snap.val()||{};
        let arr=[];
        for(let u in data) arr.push({name:u,score:data[u].score||0});
        arr.sort((a,b)=>b.score-a.score);
        let html="";
        arr.forEach((p,i)=>html+=`<div class="item">${i+1}. ${p.name} — ${p.score}</div>`);
        document.getElementById("leaders").innerHTML=html;
    });
}

appearOnline();
listenOnline();
listenLeaderboard();

</script>
</body>
</html>
