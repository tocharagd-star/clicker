<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Y ‚Äî —Å–æ—Ü—Å–µ—Ç—å</title>
<style>
body {
    margin: 0;
    background: #0d0d0d;
    color: white;
    font-family: Arial;
    overflow-x: hidden;
}

/* ======= –ê–ù–ò–ú–ê–¶–ò–ò ======= */
.fade { animation: fade .3s ease; }
@keyframes fade { from{opacity:0; transform:translateY(5px);} to{opacity:1;} }

/* ======= –ò–ù–ü–£–¢–´, –ö–ù–û–ü–ö–ò ======= */
input, textarea {
    width: 100%;
    padding: 12px;
    margin: 6px 0;
    border-radius: 10px;
    border: none;
    background: #1a1a1a;
    color: white;
}
button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    border-radius: 10px;
    border: none;
    background: #1da1f2;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: .15s;
}
button:hover { background: #0c85d0; }

/* ======= –ú–ï–ù–Æ ======= */
#topbar {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 15px;
    background: #111;
    position: sticky;
    top: 0;
    z-index: 10;
    border-bottom: 1px solid #222;
}
#topbar button {
    width: auto;
    padding: 10px 20px;
}

/* ======= –ö–û–ù–¢–ï–ô–ù–ï–† ======= */
.container { max-width: 600px; margin: 30px auto; padding: 10px; }

/* ======= –¢–í–ò–¢ ======= */
.tweet {
    background: #181818;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 12px;
    transition: .2s;
}
.tweet:hover { background:#202020; }

.tweet img { 
    width: 100%; 
    border-radius: 10px; 
    margin-top: 10px; 
}

/* ======= –†–ï–ê–ö–¶–ò–ò ======= */
.reacts span {
    margin-right: 15px;
    cursor: pointer;
    transition: .15s;
    font-size: 18px;
}
.reacts span:hover { transform: scale(1.15); }

/* ======= –°–ö–†–´–¢–´–ï –ë–õ–û–ö–ò ======= */
.hidden { display:none; }

/* ======= –ê–í–ê–¢–ê–†–ö–ê ======= */
.avatar {
    width: 50px; height: 50px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 10px;
    border: 2px solid #1da1f2;
}
.userRow { display:flex; align-items:center; margin-bottom:10px; }

</style>
</head>
<body>

<!-- ========= –í–ï–†–•–ù–ï–ï –ú–ï–ù–Æ ========= -->
<div id="topbar" class="hidden">
    <button onclick="openFeed()">–õ–µ–Ω—Ç–∞</button>
    <button onclick="openCreate()">–°–æ–∑–¥–∞—Ç—å —Ç–≤–∏—Ç</button>
</div>


<!-- ========= –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ========= -->
<div id="register" class="container fade">
    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input id="regNick" placeholder="–ù–∏–∫">
    <input id="regPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password">
    <input id="regPass2" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å" type="password">
    <input id="regAvatar" placeholder="URL –∞–≤–∞—Ç–∞—Ä–∫–∏">
    <button onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    <button onclick="showLogin()">–í–æ–π—Ç–∏</button>
</div>

<!-- ========= –í–•–û–î ========= -->
<div id="login" class="container hidden fade">
    <h2>–í—Ö–æ–¥</h2>
    <input id="logNick" placeholder="–ù–∏–∫">
    <input id="logPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <button onclick="showRegister()">–ù–∞–∑–∞–¥</button>
</div>

<!-- ========= –°–û–ó–î–ê–¢–¨ –¢–í–ò–¢ ========= -->
<div id="createTweet" class="container hidden fade">
    <h2>–°–æ–∑–¥–∞—Ç—å —Ç–≤–∏—Ç</h2>
    <textarea id="tweetText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"></textarea>
    <input id="tweetImg" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
    <button onclick="sendTweet()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</div>

<!-- ========= –õ–ï–ù–¢–ê ========= -->
<div id="feed" class="container hidden fade"></div>


<script>
/* ================= FIREBASE ================= */

const dbUrl = "https://aitube-8e681-default-rtdb.firebaseio.com/";

async function fb(path, method="GET", data=null) {
    let res = await fetch(dbUrl + path + ".json", {
        method,
        body: data ? JSON.stringify(data) : null
    });
    return await res.json();
}

/* ================= UI ================= */
const reg = document.getElementById("register");
const log = document.getElementById("login");
const feed = document.getElementById("feed");
const create = document.getElementById("createTweet");
const topbar = document.getElementById("topbar");

function showLogin(){ reg.classList.add("hidden"); log.classList.remove("hidden"); }
function showRegister(){ log.classList.add("hidden"); reg.classList.remove("hidden"); }

function openFeed(){
    create.classList.add("hidden");
    feed.classList.remove("hidden");
    loadFeed();
}
function openCreate(){
    feed.classList.add("hidden");
    create.classList.remove("hidden");
}

/* ================= –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ================= */
async function register(){
    let nick = regNick.value.trim();
    let pass = regPass.value;
    let pass2 = regPass2.value;
    let avatar = regAvatar.value.trim();

    if(!nick || !pass || pass!==pass2){ alert("–û—à–∏–±–∫–∞"); return; }

    let users = await fb("users");
    if(users && users[nick]){ alert("–ù–∏–∫ –∑–∞–Ω—è—Ç"); return; }

    await fb("users/"+nick, "PUT", {
        pass, avatar,
        react: {}   // —Ö—Ä–∞–Ω–∏–º –∫—Ç–æ –∑–∞ —á—Ç–æ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª
    });

    alert("–°–æ–∑–¥–∞–Ω–æ");
    showLogin();
}

/* ================= –í–•–û–î ================= */
async function login(){
    let nick = logNick.value.trim();
    let pass = logPass.value;

    let u = await fb("users/"+nick);
    if(!u || u.pass !== pass){ alert("–û—à–∏–±–∫–∞"); return; }

    localStorage.nick = nick;
    reg.classList.add("hidden");
    log.classList.add("hidden");
    topbar.classList.remove("hidden");
    openFeed();
}

/* ================= –°–û–ó–î–ê–¢–¨ –¢–í–ò–¢ ================= */
async function sendTweet(){
    let text = tweetText.value.trim();
    let img = tweetImg.value.trim();
    let nick = localStorage.nick;
    let user = await fb("users/"+nick);

    if(!text && !img) return;

    await fb("tweets","POST",{
        nick,
        avatar: user.avatar,
        text, img,
        time: Date.now(),
        reactions: { like:0, laugh:0, wow:0 }
    });

    tweetText.value="";
    tweetImg.value="";
    openFeed();
}

/* ================= –†–ï–ê–ö–¶–ò–ò (—Ñ–∏–∫—Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –∫–ª–∏–∫–æ–≤) ================= */
async function react(id, type){
    let nick = localStorage.nick;

    let tweet = await fb("tweets/"+id);
    let user = await fb("users/"+nick);

    if(!tweet || !user) return;

    if(!user.react) user.react = {};

    let prev = user.react[id]; // –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ä–µ–∞–∫—Ü–∏—è

    // –µ—Å–ª–∏ —Ä–µ–∞–∫—Ü–∏—è —Ç–∞ –∂–µ ‚Üí –æ—Ç–º–µ–Ω–∞
    if(prev === type){
        tweet.reactions[type]--;
        delete user.react[id];
    }
    else {
        // —É–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—É—é —Ä–µ–∞–∫—Ü–∏—é
        if(prev){
            tweet.reactions[prev]--;
        }
        // —Å—Ç–∞–≤–∏–º –Ω–æ–≤—É—é
        tweet.reactions[type]++;
        user.react[id] = type;
    }

    await fb("tweets/"+id, "PUT", tweet);
    await fb("users/"+nick, "PUT", user);

    loadFeed();
}

/* ================= –õ–ï–ù–¢–ê ================= */
async function loadFeed(){
    feed.innerHTML = "";

    let tweets = await fb("tweets");
    if(!tweets) return;

    let arr = Object.entries(tweets).sort((a,b)=>b[1].time - a[1].time);

    for(let [id,t] of arr){
        feed.innerHTML += `
        <div class="tweet fade">
            <div class="userRow">
                <img class="avatar" src="${t.avatar}">
                <b>${t.nick}</b>
            </div>
            ${t.text? `<div>${t.text}</div>`:""}
            ${t.img? `<img src="${t.img}">`:""}
            <div class="reacts" style="margin-top:10px;">
                <span onclick="react('${id}','like')">‚ù§Ô∏è ${t.reactions.like}</span>
                <span onclick="react('${id}','laugh')">üòÇ ${t.reactions.laugh}</span>
                <span onclick="react('${id}','wow')">üòÆ ${t.reactions.wow}</span>
            </div>
        </div>
        `;
    }
}
</script>
</body>
</html>
