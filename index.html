<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>2D Minecraft Online Prototype</title>
<style>
    body { margin:0; background:#222; }
    canvas { background:#66bb6a; display:block; margin:0 auto; }
</style>
</head>
<body>

<canvas id="game" width="800" height="600"></canvas>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* -------------------- 1. Firebase -------------------- */
const firebaseConfig = {
    databaseURL: "https://clicker-3044c-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* -------------------- 2. Игровые переменные -------------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const playerId = "player_" + Math.random().toString(36).substr(2, 9);
let players = {};

let me = {
    x: Math.random()*700 + 50,
    y: Math.random()*500 + 50,
    color: "#" + ((Math.random()*0xffffff)|0).toString(16),
};

/* -------------------- 3. Управление -------------------- */
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/* -------------------- 4. Синхронизация с Firebase -------------------- */
const ref = db.ref("minecraft2d/players");

// слушаем обновления всех игроков
ref.on("value", snap => {
    players = snap.val() || {};
});

// отправляем обновления о себе
setInterval(() => {
    ref.child(playerId).set(me);
}, 100);

/* -------------------- 5. Игровой цикл -------------------- */
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

function update() {
    const speed = 3;
    if (keys["w"] || keys["ArrowUp"])    me.y -= speed;
    if (keys["s"] || keys["ArrowDown"])  me.y += speed;
    if (keys["a"] || keys["ArrowLeft"])  me.x -= speed;
    if (keys["d"] || keys["ArrowRight"]) me.x += speed;
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // рисуем всех игроков
    for (let id in players) {
        let p = players[id];
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 30, 30);

        ctx.fillStyle = "black";
        ctx.fillText(id, p.x, p.y - 5);
    }
}

gameLoop();

/* -------------------- 6. Удаляем игрока при выходе -------------------- */
window.addEventListener("beforeunload", () => {
    ref.child(playerId).remove();
});
</script>

</body>
</html>
        // Конфигурация Firebase
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project-id.firebaseapp.com",
            databaseURL: "https://clicker-3044c-default-rtdb.firebaseio.com/",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Инициализация Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Инициализация канваса
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Структуры игрока
        let players = {};
        let playerId = Date.now().toString(); // уникальный id для игрока
        let player = {
            x: 100,
            y: 100,
            width: 20,
            height: 20,
            color: 'red'
        };

        // Отображение игроков
        function drawPlayers() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Очистка канваса
            for (let id in players) {
                let p = players[id];
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.width, p.height);
            }
        }

        // Обновление позиции игрока на Firebase
        function updatePlayerPosition() {
            firebase.database().ref('players/' + playerId).set({
                x: player.x,
                y: player.y,
                color: player.color
            });
        }

        // Получение данных всех игроков из Firebase
        firebase.database().ref('players').on('value', (snapshot) => {
            players = snapshot.val() || {};
            drawPlayers();
        });

        // Обработчик движения игрока
        document.addEventListener('keydown', (e) => {
            const speed = 5;
            switch (e.key) {
                case 'ArrowUp':
                    player.y -= speed;
                    break;
                case 'ArrowDown':
                    player.y += speed;
                    break;
                case 'ArrowLeft':
                    player.x -= speed;
                    break;
                case 'ArrowRight':
                    player.x += speed;
                    break;
            }
            updatePlayerPosition();
        });

        // Первоначальная установка игрока в Firebase
        firebase.database().ref('players/' + playerId).set({
            x: player.x,
            y: player.y,
            color: player.color
        });

        // Постоянный рендеринг игры
        function gameLoop() {
            requestAnimationFrame(gameLoop);
            drawPlayers();
        }

        gameLoop(); // Начало игрового цикла
    </script>
</body>
</html>
</div>

<div id="menu" class="hidden">
<button id="leadersBtn">Лидеры</button>
<button id="upgradesBtn">Апгрейды</button>
<button id="profileBtn">Профиль</button>
</div>

<div id="game" class="hidden">
<div id="score">0</div>
<button id="clickBtn">Клик!</button>

<div id="leadersPanel" class="panel">
<h3>Лидерборд <span class="close" onclick="closePanel('leadersPanel')">&times;</span></h3>
<div id="leadersList"></div>
</div>

<div id="upgradesPanel" class="panel">
<h3>Апгрейды <span class="close" onclick="closePanel('upgradesPanel')">&times;</span></h3>
<button id="autoClickBtn">Автоклик (+1/сек) — 50</button>
<button id="bonusClickBtn">Бонус клик (+1/клик) — 100</button>
</div>

<div id="profilePanel" class="panel">
<h3>Профиль <span class="close" onclick="closePanel('profilePanel')">&times;</span></h3>
<input type="text" id="customNick" placeholder="Новый ник">
<select id="colorSelect">
<option value="#fff">Белый</option>
<option value="#ff0">Жёлтый</option>
<option value="#0f0">Зелёный</option>
<option value="#0ff">Голубой</option>
<option value="#f0f">Фиолетовый</option>
</select>
<button id="saveProfileBtn">Сохранить</button>
</div>
</div>

<script>
const firebaseConfig = {
apiKey:"AIzaSyB7d3kYeYEcTUy8tz-hKbYMw5f5zbRH6Ug",
authDomain:"clicker-3044c.firebaseapp.com",
databaseURL:"https://clicker-3044c-default-rtdb.firebaseio.com",
projectId:"clicker-3044c",
storageBucket:"clicker-3044c.firebasestorage.app",
messagingSenderId:"143909161656",
appId:"1:143909161656:web:368498af1ab183e56d024d",
measurementId:"G-JWS932SQBG"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// ---------------- State ----------------
let user=null, photo=null, score=0, autoClick=false, bonusPerClick=1, autoClickCost=50, bonusClickCost=100;

// ---------------- Login ----------------
function startGame(){
document.getElementById("loginScreen").style.display="none";
document.getElementById("menu").classList.remove("hidden");
document.getElementById("game").classList.remove("hidden");
document.getElementById("score").innerText=score;
appearOnline(); listenLeaderboard();
}

// ---------------- Registration ----------------
document.getElementById("registerBtn").addEventListener("click",()=>{
let nick=document.getElementById("nickname").value.trim();
if(!nick) nick="Игрок"+Math.floor(Math.random()*1000);
user=nick; photo=null; score=0;
saveAll(); startGame();
});

// ---------------- Click ----------------
document.getElementById("clickBtn").addEventListener("click",()=>{
score+=bonusPerClick;
document.getElementById("score").innerText=score;
saveAll();
animateScore();
});
function animateScore(){ const el=document.getElementById("score"); el.style.transform="scale(1.3)"; setTimeout(()=>el.style.transform="scale(1)",100); }

// ---------------- Panels ----------------
function showPanel(id){ document.getElementById(id).style.display='block'; }
function closePanel(id){ document.getElementById(id).style.display='none'; }

document.getElementById("leadersBtn").addEventListener("click",()=>showPanel("leadersPanel"));
document.getElementById("upgradesBtn").addEventListener("click",()=>showPanel("upgradesPanel"));
document.getElementById("profileBtn").addEventListener("click",()=>showPanel("profilePanel"));

// ---------------- Upgrades ----------------
document.getElementById("autoClickBtn").addEventListener("click",()=>{
if(score>=autoClickCost){ score-=autoClickCost; autoClick=true; autoClickCost*=2; startAutoClick(); updateUpgradeText(); saveAll(); }});
document.getElementById("bonusClickBtn").addEventListener("click",()=>{
if(score>=bonusClickCost){ score-=bonusClickCost; bonusPerClick++; bonusClickCost*=2; updateUpgradeText(); saveAll(); }});
function startAutoClick(){ if(!window.autoClickInterval){ window.autoClickInterval=setInterval(()=>{score+=1; document.getElementById("score").innerText=score; saveAll(); animateScore();},1000); } }
function updateUpgradeText(){
document.getElementById("autoClickBtn").innerText=`Автоклик (+1/сек) — ${autoClickCost}`;
document.getElementById("bonusClickBtn").innerText=`Бонус клик (+1/клик) — ${bonusClickCost}`;
}

// ---------------- Profile ----------------
document.getElementById("saveProfileBtn").addEventListener("click",()=>{
const newNick=document.getElementById("customNick").value.trim();
if(newNick) user=newNick;
const color=document.getElementById("colorSelect").value;
document.getElementById("score").style.color=color;
saveAll();
});

// ---------------- Save ----------------
function saveAll(){
db.ref("users/"+user).set({score, photo, autoClick, bonusPerClick, autoClickCost, bonusClickCost});
localStorage.setItem("clickerUser", JSON.stringify({user, photo, score, autoClick, bonusPerClick, autoClickCost, bonusClickCost}));
}

// ---------------- Leaderboard ----------------
function listenLeaderboard(){
db.ref("users").on("value",snap=>{
const data=snap.val()||{}; let arr=[];
for(let u in data) arr.push({name:u,score:data[u].score||0,photo:data[u].photo||null});
arr.sort((a,b)=>b.score-b.score); let html="";
arr.forEach((p,i)=>{
let icon=p.photo?`<img src="${p.photo}">`:"<div style='width:32px;height:32px;margin-right:8px'></div>";
html+=`<div class="item">${icon}${i+1}. ${p.name} — ${p.score}</div>`;
});
document.getElementById("leadersList").innerHTML=html;
});
}

// ---------------- Online ----------------
function appearOnline(){ setInterval(()=>db.ref("online/"+user).set(Date.now()),1000); }
</script>
</body>
</html>


