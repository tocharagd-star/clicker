<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Geometry Dash Clone</title>
<style>
  body { margin: 0; background: #222; overflow: hidden; font-family: sans-serif; color: #fff; }
  canvas { display: block; background: #333; margin: 0 auto; }
  #gui { position: absolute; top: 10px; left: 10px; }
  button { margin: 5px; padding: 5px 10px; background: #555; border: none; color: white; cursor: pointer; }
  input { padding: 5px; margin: 5px; }
</style>
</head>
<body>

<div id="gui">
  <button id="playBtn">Играть</button>
  <button id="editorBtn">Редактор</button>
  <input type="text" id="levelName" placeholder="Имя уровня">
  <button id="saveBtn">Сохранить уровень</button>
  <button id="loadBtn">Загрузить уровень</button>
</div>

<canvas id="gameCanvas" width="800" height="400"></canvas>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
  // Firebase setup
  const firebaseConfig = {
    databaseURL: "https://aitube-8e681-default-rtdb.firebaseio.com/"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  let gameMode = 'menu'; // 'menu', 'play', 'edit'
  let player = { x: 50, y: 300, w: 30, h: 30, vy: 0, onGround: false };
  let gravity = 0.7;
  let jumpPower = -12;
  let obstacles = [];
  let levelData = [];
  let scroll = 0;
  let speed = 4;

  function spawnObstacle(x, y, w, h) {
    obstacles.push({ x, y, w, h });
  }

  function resetGame() {
    player.y = 300;
    player.vy = 0;
    scroll = 0;
    obstacles = [];
    for(let block of levelData){
      spawnObstacle(block.x, block.y, block.w, block.h);
    }
  }

  function update() {
    if(gameMode === 'play') {
      player.vy += gravity;
      player.y += player.vy;
      if(player.y + player.h > canvas.height){
        player.y = canvas.height - player.h;
        player.vy = 0;
        player.onGround = true;
      } else {
        player.onGround = false;
      }

      scroll += speed;
      for(let obs of obstacles){
        obs.x -= speed;
        if(player.x < obs.x + obs.w && player.x + player.w > obs.x &&
           player.y < obs.y + obs.h && player.y + player.h > obs.y){
          resetGame();
        }
      }
    }
    draw();
    requestAnimationFrame(update);
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Player
    ctx.fillStyle = 'yellow';
    ctx.fillRect(player.x, player.y, player.w, player.h);
    // Obstacles
    ctx.fillStyle = 'red';
    for(let obs of obstacles){
      ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
    }
    // Editor
    if(gameMode === 'edit'){
      ctx.fillStyle = 'cyan';
      for(let block of levelData){
        ctx.fillRect(block.x, block.y, block.w, block.h);
      }
    }
  }

  document.addEventListener('keydown', e => {
    if(e.code === 'Space'){
      if(player.onGround){
        player.vy = jumpPower;
      }
      if(gameMode === 'edit'){
        // add block where player is
        levelData.push({x: player.x + scroll, y: player.y, w: 40, h: 40});
      }
    }
  });

  // Buttons
  document.getElementById('playBtn').onclick = () => {
    gameMode = 'play';
    resetGame();
  };
  document.getElementById('editorBtn').onclick = () => {
    gameMode = 'edit';
    obstacles = [];
  };
  document.getElementById('saveBtn').onclick = () => {
    const name = document.getElementById('levelName').value || 'default';
    db.ref('levels/' + name).set(levelData);
    alert('Уровень сохранён!');
  };
  document.getElementById('loadBtn').onclick = () => {
    const name = document.getElementById('levelName').value || 'default';
    db.ref('levels/' + name).once('value').then(snapshot => {
      levelData = snapshot.val() || [];
      alert('Уровень загружен!');
    });
  };

  update();
</script>

</body>
</html>
