<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Clicker Pro</title>
<style>
body { margin:0; font-family:sans-serif; background:#1e1e2f; color:#fff; display:flex; height:100vh; }
#menu { width:120px; background:#2a2a3f; display:flex; flex-direction:column; align-items:center; padding:10px; }
#menu button { width:100px; height:60px; margin:10px 0; border:none; border-radius:12px; font-size:14px; cursor:pointer; background:#4e4eff; color:#fff; transition:0.2s; }
#menu button:hover { background:#6f6fff; transform:scale(1.05); }
#game { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; }
#score { font-size:48px; margin-bottom:20px; transition: transform 0.2s; }
#clickBtn { width:200px; height:200px; border-radius:50%; border:none; background:#ff5050; color:#fff; font-size:24px; cursor:pointer; transition: transform 0.1s, box-shadow 0.1s; }
#clickBtn:active { transform: scale(0.95); box-shadow:0 0 20px #ff8888; }
.panel { position:absolute; top:50px; right:20px; width:300px; background:#2a2a3f; border-radius:12px; padding:15px; display:none; box-shadow:0 0 15px #000; z-index:10; }
.panel h3 { margin:0 0 10px 0; display:flex; justify-content:space-between; align-items:center; }
.panel h3 span.close { cursor:pointer; font-size:20px; color:#f55; }
.panel button { width:100%; margin:5px 0; border-radius:8px; background:#4e4eff; color:#fff; border:none; cursor:pointer; transition:0.2s; }
.panel button:hover { background:#6f6fff; }
.item { display:flex; align-items:center; margin:5px 0; }
.item img { width:32px; height:32px; border-radius:50%; margin-right:8px; }
#loginScreen { position:absolute; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:#1e1e2f; flex-direction:column; z-index:20; }
#loginScreen input, #loginScreen button { margin:5px; padding:10px; border-radius:6px; border:none; font-size:16px; }
#loginScreen button { background:#4e4eff; color:#fff; cursor:pointer; transition:0.2s; }
#loginScreen button:hover { background:#6f6fff; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

</head>
<body>

<!-- Login -->
<div id="loginScreen">
<h1>Вход / Регистрация</h1>
<input type="text" id="nickname" placeholder="Введите ник">
<button id="registerBtn">Зарегистрироваться</button>
<button id="googleLogin">Войти через Google</button>
</div>

<!-- Menu -->
<div id="menu" class="hidden">
<button id="leadersBtn">Лидеры</button>
<button id="upgradesBtn">Апгрейды</button>
<button id="profileBtn">Профиль</button>
</div>

<!-- Game -->
<div id="game" class="hidden">
<div id="score">0</div>
<button id="clickBtn">Клик!</button>

<!-- Panels -->
<div id="leadersPanel" class="panel">
<h3>Лидерборд <span class="close" onclick="closePanel('leadersPanel')">&times;</span></h3>
<div id="leadersList"></div>
</div>

<div id="upgradesPanel" class="panel">
<h3>Апгрейды <span class="close" onclick="closePanel('upgradesPanel')">&times;</span></h3>
<button id="autoClickBtn">Автоклик (+1/сек) — 50</button>
<button id="bonusClickBtn">Бонус клик (+1/клик) — 100</button>
</div>

<div id="profilePanel" class="panel">
<h3>Профиль <span class="close" onclick="closePanel('profilePanel')">&times;</span></h3>
<input type="text" id="customNick" placeholder="Новый ник">
<select id="colorSelect">
<option value="#fff">Белый</option>
<option value="#ff0">Жёлтый</option>
<option value="#0f0">Зелёный</option>
<option value="#0ff">Голубой</option>
<option value="#f0f">Фиолетовый</option>
</select>
<button id="saveProfileBtn">Сохранить</button>
</div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB7d3kYeYEcTUy8tz-hKbYMw5f5zbRH6Ug",
  authDomain: "clicker-3044c.firebaseapp.com",
  databaseURL: "https://clicker-3044c-default-rtdb.firebaseio.com",
  projectId: "clicker-3044c",
  storageBucket: "clicker-3044c.firebasestorage.app",
  messagingSenderId: "143909161656",
  appId: "1:143909161656:web:368498af1ab183e56d024d",
  measurementId: "G-JWS932SQBG"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

// ---------------- State ----------------
let user = null;
let photo = null;
let score = 0;
let autoClick = false;
let bonusPerClick = 1;
let autoClickCost = 50;
let bonusClickCost = 100;

// ---------------- Login ----------------
function startGame(){
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("menu").classList.remove("hidden");
    document.getElementById("game").classList.remove("hidden");
    document.getElementById("score").innerText = score;
    appearOnline();
    listenOnline();
    listenLeaderboard();
}

// Load saved
if(localStorage.getItem("clickerUser")){
    const saved = JSON.parse(localStorage.getItem("clickerUser"));
    user = saved.user; photo = saved.photo; score = saved.score || 0;
    autoClick = saved.autoClick || false;
    bonusPerClick = saved.bonusPerClick || 1;
    autoClickCost = saved.autoClickCost || 50;
    bonusClickCost = saved.bonusClickCost || 100;
    startGame();
}

// ---------------- Registration ----------------
document.getElementById("registerBtn").addEventListener("click",()=>{
    let nick=document.getElementById("nickname").value.trim();
    if(!nick) nick="Игрок"+Math.floor(Math.random()*1000);
    user = nick; photo=null; score=0;
    saveAll();
    startGame();
});

// ---------------- Google Login ----------------
document.getElementById("googleLogin").addEventListener("click",()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result=>{
        user = result.user.displayName || "Игрок"+Math.floor(Math.random()*1000);
        photo = result.user.photoURL; score=0;
        saveAll();
        startGame();
    }).catch(err=>alert("Ошибка Google: "+err.message));
});

// ---------------- Click ----------------
document.getElementById("clickBtn").addEventListener("click",()=>{
    score+=bonusPerClick;
    document.getElementById("score").innerText=score;
    saveAll();
    animateScore();
});
function animateScore(){
    const scoreEl = document.getElementById("score");
    scoreEl.style.transform="scale(1.3)";
    setTimeout(()=>scoreEl.style.transform="scale(1)",100);
}

// ---------------- Panels ----------------
function showPanel(id){ document.getElementById(id).style.display='block'; }
function closePanel(id){ document.getElementById(id).style.display='none'; }

// ---------------- Upgrades ----------------
document.getElementById("autoClickBtn").addEventListener("click",()=>{
    if(score>=autoClickCost){ score-=autoClickCost; autoClick=true; autoClickCost*=2; startAutoClick(); updateUpgradeText(); saveAll(); }
});
document.getElementById("bonusClickBtn").addEventListener("click",()=>{
    if(score>=bonusClickCost){ score-=bonusClickCost; bonusPerClick++; bonusClickCost*=2; updateUpgradeText(); saveAll(); }
});
function startAutoClick(){ if(!window.autoClickInterval){ window.autoClickInterval=setInterval(()=>{ score+=1; document.getElementById("score").innerText=score; saveAll(); animateScore(); },1000); } }
function updateUpgradeText(){
    document.getElementById("autoClickBtn").innerText=`Автоклик (+1/сек) — ${autoClickCost}`;
    document.getElementById("bonusClickBtn").innerText=`Бонус клик (+1/клик) — ${bonusClickCost}`;
}

// ---------------- Profile ----------------
document.getElementById("saveProfileBtn").addEventListener("click",()=>{
    const newNick=document.getElementById("customNick").value.trim();
    if(newNick) user=newNick;
    const color=document.getElementById("colorSelect").value;
    document.getElementById("score").style.color=color;
    saveAll();
});

// ---------------- Save ----------------
function saveAll(){
    db.ref("users/"+user).set({score, photo, autoClick, bonusPerClick, autoClickCost, bonusClickCost});
    localStorage.setItem("clickerUser", JSON.stringify({user, photo, score, autoClick, bonusPerClick, autoClickCost, bonusClickCost}));
}

// ---------------- Online ----------------
function appearOnline(){ setInterval(()=> db.ref("online/"+user).set(Date.now()),1000); }
function listenOnline(){
    db.ref("online").on("value",snap=>{
        const data=snap.val()||{}; const now=Date.now(); let html="";
        for(let u in data) if(now-data[u]<3000) html+=`<div class="item">${u}</div>`;
        document.getElementById("online")?.innerHTML=html;
    });
}

// ---------------- Leaderboard ----------------
function listenLeaderboard(){
    db.ref("users").on("value",snap=>{
        const data=snap.val()||{}; let arr=[];
        for(let u in data) arr.push({name:u,score:data[u].score||0,photo:data[u].photo||null});
        arr.sort((a,b)=>b.score-a.score);
        let html="";
        arr.forEach((p,i)=>{
            let icon=p.photo?`<img src="${p.photo}">`:"<div style='width:32px;height:32px;margin-right:8px'></div>";
            html+=`<div class="item">${icon}${i+1}. ${p.name} — ${p.score}</div>`;
        });
        document.getElementById("leadersList").innerHTML=html;
    });
}
</script>
</body>
</html>
